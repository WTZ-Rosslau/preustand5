<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prüfstand 5</title>
    <!-- Link to Google Fonts for Raleway -->
   <!-- <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;600&display=swap" rel="stylesheet">-->
    <link rel="icon" href="gas-4.png" type="image/x-icon">
   
    <!-- Link to external CSS file -->
    <link href="Dashboard_2.css" rel="stylesheet">
</head>
<body>
    <header>
        <img src="WTZ-Logo-512px.png" alt="Logo">
        <div class="header-title">Status der Gaswarnanlagen</div>
    </header>


    




    

<table id="status-table">
    <caption>
        Empfangstatus
    </caption>
    <tr>
        <td >Prüfstand 5</td>
        <td id="status-cell" > aktiv </td>
         <td>  <span id="light-cell" class="light green-light"></span> </td>
    </tr>
</table>


    


    
   
    <table>
        <caption>
            Prüfstand 5 - Gaswarnanlage -YG1
             
            
        </caption>
        <thead>
            <tr>
                <th>Kanal</th>
                <th>1</th>
                <th>2</th>
                <th>3</th>
                <th>4</th>
                <th>5</th>
                <th>6</th>
                <th>7</th>
                <th>8</th>
            </tr>
        </thead>
        <tbody>
          <tr>
    <td>Gasart</td>
    <td>
        
            <span style="font-weight: bold; color: gold;font-size: 1.2em;">O<sub>2</sub></span>
            <small class="small-white">Raum</small>
        
    </td>
    <td>
        
            <span style="font-weight: bold; color: gold;font-size: 1.2em;">CH<sub>3</sub>OH</span>
            <small class="small-white">Raum</small>
        
    </td>
    <td>
        
            <span style="font-weight: bold; color: gold;font-size: 1.2em;">O<sub>2</sub></span>
            <small class="small-white">Anlage</small>
        
    </td>
    <td>
        
            <span style="font-weight: bold; color: gold;font-size: 1.2em;">CH<sub>3</sub>OH</span>
            <small class="small-white">Anlage</small>
        
    </td>
    <td>
        
            <span style="font-weight: bold; color: gold;font-size: 0.7em;">Flammenwächter<sub></sub></span>
            <small class="small-white"></small>
        
    </td>
    <td>
        
            <span style="font-weight: bold; color: gold;font-size: 1.2em;">-<sub></sub></span>
            <small class="small-white"></small>
        
    </td>
    <td>
        
            <span style="font-weight: bold; color: gold;font-size: 1.2em;">-<sub></sub></span>
            <small class="small-white"></small>
        
    </td>
    <td>
        
            <span style="font-weight: bold; color: gold;font-size: 1.2em;">-<sub></sub></span>
            <small class="small-white"></small>
        
    </td>
</tr>

<tr>
    <td>Zeit</td>
   <td id="Zeit_Datum_A_1" colspan="8" style="text-align: center;"> </td>

</tr>

            
            <tr>
    <td>Messwert</td>
    <td id="Messwert_AA_1"></td>
    <td id="Messwert_AB_1"></td>
    <td id="Messwert_AC_1"></td>
    <td id="Messwert_AD_1"></td>
    <td id="Messwert_AE_1"></td>
    <td id="Messwert_AF_1"></td>
    <td id="Messwert_AG_1"></td>
    <td id="Messwert_AH_1"></td>
</tr>
   <tr>
    <td>Alarmstatus 1</td>
    <td id="Alarmstatus1_AI_1"></td>
    <td id="Alarmstatus1_AJ_1"></td>
    <td id="Alarmstatus1_AK_1"></td>
    <td id="Alarmstatus1_AL_1"></td>
    <td id="Alarmstatus1_AM_1"></td>
    <td id="Alarmstatus1_AN_1"></td>
    <td id="Alarmstatus1_AO_1"></td>
    <td id="Alarmstatus1_AP_1"></td>
</tr>
<tr>
    <td>Alarmstatus 2</td>
    <td id="Alarmstatus2_AQ_1"></td>
    <td id="Alarmstatus2_AR_1"></td>
    <td id="Alarmstatus2_AS_1"></td>
    <td id="Alarmstatus2_AT_1"></td>
    <td id="Alarmstatus2_AU_1"></td>
    <td id="Alarmstatus2_AV_1"></td>
    <td id="Alarmstatus2_AW_1"></td>
    <td id="Alarmstatus2_AX_1"></td>
</tr>
<tr>
    <td>Alarmstatus 3</td>
    <td id="Alarmstatus3_AY_1"></td>
    <td id="Alarmstatus3_AZ_1"></td>
    <td id="Alarmstatus3_BA_1"></td>
    <td id="Alarmstatus3_BB_1"></td>
    <td id="Alarmstatus3_BC_1"></td>
    <td id="Alarmstatus3_BD_1"></td>
    <td id="Alarmstatus3_BE_1"></td>
    <td id="Alarmstatus3_BF_1"></td>
</tr>
<tr>
    <td>Kanalstörung</td>
    <td id="KanalStorung_BG_1"></td>
    <td id="KanalStorung_BH_1"></td>
    <td id="KanalStorung_BI_1"></td>
    <td id="KanalStorung_BJ_1"></td>
    <td id="KanalStorung_BK_1"></td>
    <td id="KanalStorung_BL_1"></td>
    <td id="KanalStorung_BM_1"></td>
    <td id="KanalStorung_BN_1"></td>
</tr>
<tr>
    <td>Betriebsstatus</td>
    <td id="Betriebsstatus_BO_1"></td>
    <td id="Betriebsstatus_BP_1"></td>
    <td id="Betriebsstatus_BQ_1"></td>
    <td id="Betriebsstatus_BR_1"></td>
    <td id="Betriebsstatus_BS_1"></td>
    <td id="Betriebsstatus_BT_1"></td>
    <td id="Betriebsstatus_BU_1"></td>
    <td id="Betriebsstatus_BV_1"></td>
</tr>
        </tbody>
    </table>


    <!-- Link to external JS file -->
<script type="module">
console.log("Script loaded"); // test log

// Import necessary Firebase modules
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
// Your Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCbeH7v1UaIcFLKYSiiwGn_w-z0HcXeQOE",
  authDomain: "preufstand5.firebaseapp.com",
  databaseURL: "https://preufstand5-default-rtdb.firebaseio.com",
  projectId: "preufstand5",
  storageBucket: "preufstand5.firebasestorage.app",
  messagingSenderId: "970349287368",
  appId: "1:970349287368:web:8d59a556b9b0d0adca52fd",
  measurementId: "G-078JCJ5ESN"
};


// Initialize Firebase
const app = initializeApp(firebaseConfig);

// Initialize Realtime Database
const database = getDatabase(app);

// Reference to the 'real_time_data' node in Firebase
const dataRef = ref(database, 'Preufstand5');

// Array of keys to update
const new_keys = [
   "Zeit_Datum_A_2" ,"Zeit_Datum_A_1" ,"Messwert_AA_1", "Messwert_AA_2", "Messwert_AB_1", "Messwert_AB_2", "Messwert_AC_1", "Messwert_AC_2", "Messwert_AD_1", "Messwert_AD_2",
    "Messwert_AE_1", "Messwert_AE_2", "Messwert_AF_1", "Messwert_AF_2", "Messwert_AG_1", "Messwert_AG_2", "Messwert_AH_1", "Messwert_AH_2",
    "Alarmstatus1_AI_1", "Alarmstatus1_AI_2", "Alarmstatus1_AJ_1", "Alarmstatus1_AJ_2", "Alarmstatus1_AK_1", "Alarmstatus1_AK_2", "Alarmstatus1_AL_1", "Alarmstatus1_AL_2",
    "Alarmstatus1_AM_1", "Alarmstatus1_AM_2", "Alarmstatus1_AN_1", "Alarmstatus1_AN_2", "Alarmstatus1_AO_1", "Alarmstatus1_AO_2", "Alarmstatus1_AP_1", "Alarmstatus1_AP_2",
    "Alarmstatus2_AQ_1", "Alarmstatus2_AQ_2", "Alarmstatus2_AR_1", "Alarmstatus2_AR_2", "Alarmstatus2_AS_1", "Alarmstatus2_AS_2", "Alarmstatus2_AT_1", "Alarmstatus2_AT_2",
    "Alarmstatus2_AU_1", "Alarmstatus2_AU_2", "Alarmstatus2_AV_1", "Alarmstatus2_AV_2", "Alarmstatus2_AW_1", "Alarmstatus2_AW_2", "Alarmstatus2_AX_1", "Alarmstatus2_AX_2",
    "KanalStorung_BG_1", "KanalStorung_BG_2", "KanalStorung_BH_1", "KanalStorung_BH_2", "KanalStorung_BI_1", "KanalStorung_BI_2", "KanalStorung_BJ_1", "KanalStorung_BJ_2",
    "KanalStorung_BK_1", "KanalStorung_BK_2", "KanalStorung_BL_1", "KanalStorung_BL_2", "KanalStorung_BM_1", "KanalStorung_BM_2", "KanalStorung_BN_1", "KanalStorung_BN_2",
    "Betriebsstatus_BO_1", "Betriebsstatus_BO_2", "Betriebsstatus_BP_1", "Betriebsstatus_BP_2", "Betriebsstatus_BQ_1", "Betriebsstatus_BQ_2", "Betriebsstatus_BR_1", "Betriebsstatus_BR_2",
    "Betriebsstatus_BS_1", "Betriebsstatus_BS_2", "Betriebsstatus_BT_1", "Betriebsstatus_BT_2", "Betriebsstatus_BU_1", "Betriebsstatus_BU_2", "Betriebsstatus_BV_1", "Betriebsstatus_BV_2",
    "Alarmstatus3_AY_1", "Alarmstatus3_AY_2", "Alarmstatus3_AZ_1", "Alarmstatus3_AZ_2", "Alarmstatus3_BA_1", "Alarmstatus3_BA_2", "Alarmstatus3_BB_1", "Alarmstatus3_BB_2",
    "Alarmstatus3_BC_1", "Alarmstatus3_BC_2", "Alarmstatus3_BD_1", "Alarmstatus3_BD_2", "Alarmstatus3_BE_1", "Alarmstatus3_BE_2", "Alarmstatus3_BF_1", "Alarmstatus3_BF_2"
];

// Function to update the status cell based on timestamp difference
function updateStatusCell(data) {
    const currentTime = Date.now(); // Get current time in milliseconds

    if (data.TimeStamp !== undefined) {
        const timeStamp = parseFloat(data.TimeStamp) * 1000; // Convert timestamp to milliseconds
        const timeDifference = (currentTime - timeStamp) / 1000; // Difference in seconds

        console.log(`Current Time: ${currentTime}`);
        console.log(`Timestamp: ${timeStamp}`);
        console.log(`Time Difference: ${timeDifference} seconds`);

        const statusCell = document.getElementById('status-cell'); // Assuming 'status-cell' is the ID of the cell to update
        const lightCell = document.getElementById('light-cell'); // Assuming 'light-cell' is the ID of the light indicator cell

        if (statusCell && lightCell) {
            if (timeDifference > 20) {
                statusCell.innerText = 'inaktiv';
                lightCell.classList.remove('green-light');
                lightCell.classList.add('red-light');
                console.log("Status updated to inaktiv");
            } else {
                statusCell.innerText = 'aktiv';
                lightCell.classList.remove('red-light');
                lightCell.classList.add('green-light');
                console.log("Status updated to aktiv");
            }
        } else {
            console.log("Missing status cell or light cell element");
        }
    } else {
        console.log("No timestamp found");
    }
}

// Listen for changes in the dataRef
onValue(dataRef, (snapshot) => {
    const data = snapshot.val();

    if (data) {
        new_keys.forEach(key => {
            if (data[key] !== undefined && document.getElementById(key)) {
                // Update the text of the table cell
                const cell = document.getElementById(key);
                cell.innerText = data[key];

                // Only apply color change to Alarmstatus1, Alarmstatus2, Alarmstatus3, and KanalStorung
                if (key.includes("Alarmstatus") || key.includes("KanalStorung")) {
                    // Example threshold value for changing the cell color
                    const threshold = 1;

                    // Ensure the value is a number before comparison
                    const value = parseFloat(data[key]);

                    if (!isNaN(value)) {
                        if (value >= threshold) {
                            // Add the red background color class if the value exceeds the threshold
                            cell.classList.add('red-cell');
                        } else {
                            // Remove the red background color if the value is below the threshold
                            cell.classList.remove('red-cell');
                        }
                    }
                }
            } else {
                console.log(`Missing data or element for: ${key}`);
            }
        });

        // Update the status cell based on timestamp difference
        updateStatusCell(data);
    } else {
        console.log("No data found");
    }
});

// Periodically check the timestamp and update the status cell
setInterval(() => {
    onValue(dataRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            updateStatusCell(data);
        }
    });
}, 1000); // Check every second
</script>


</body>
</html>



